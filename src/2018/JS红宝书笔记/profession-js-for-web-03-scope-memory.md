## 变量、作用域和内存问题
- 变量和值
    - JavaScript 松散类型决定变量只是在特定时间用于保存特定**值**的一个名字而已。
    - 值可分为两种类型：
        - `基本类型`值在内存中占据固定大小的空间，保存在栈内存中
        - `引用类型`值是对象，保存在堆内存中（a.可以动态改变属性）。保存引用类型值的变量实际上保存的是一个指向该对象的指针，而不是对象本身。(b.具体差异在值复制过程中表现尤为明显。)
        - vs
            - a. 动态的属性
            - b. 复制变量值（浅拷贝）·
            - c. 传递参数
                - 都是**按值传递**
                - 在向参数传递：
                    - 基本类型值时，被传递的值会被复制给一个局部变量（即命名参数 / arguments 对象中的一个元素）。
                    - 引用类型值时，会把这个值在内存中的地址复制给一个局部变量，因此这个局部变量的变化会反映在函数的外部。（但不是按引用传递，因为按引用传递修改局部对象引用并不会影响外部对象的引用）
        - 确定一个值（类型检测）：
            - 是哪种基本类型：typeof

复制基本类型值：
![default](https://user-images.githubusercontent.com/3774016/43440930-ad7b80ca-94cb-11e8-9102-c97374fc328b.png)

复制引用类型值：
![default](https://user-images.githubusercontent.com/3774016/43440938-b5a193ca-94cb-11e8-874e-6f4dd9fb9875.png)

- 执行环境及作用域
    - 执行环境（execution context），定义了变量或函数有权访问的其他数据，决定了它们各自的行为。
    - 每个执行环境都有一个与之关联的**变量对象（variable object）**，环境中定义的所有变量和函数都保存在这个对象中。
    - 执行环境可分为全局执行环境（也称为全局环境）和函数执行环境之分。
        - 全局执行环境：ECMAScript 实现所在的宿主环境不同，表示执行环境的对象也不同。，在 Web 浏览器中全局执行环境 -> window
        - 函数执行环境：当执行流进入一个函数时，函数的环境就会被推入一个环境栈中
    - 某个执行环境中的所有代码执行完毕后（全局执行环境 -> 应用程序退出或关闭网页；函数执行环境 -> 函数执行完毕），该环境被销毁，保存在其中的所有变量和函数定义也会随之销毁
    - 当代码在一个环境中执行时，会创建**变量对象的一个作用域链（scope chain）**。用以保证对执行环境有权访问的所有变量和函数的有序访问。
        - 作用域链的前端，始终都是当前执行代码所在环境的变量对象
            - 如果这个环境是函数，则将其活动对象作为变量对象，最开始只包含一个变量，即 arguments 对象
        - 作用域链的最后一个，始终都是全局执行环境的变量对象
    - 延长作用域链
        - 虽然执行环境的类型只有两种——全局和局部（函数），但是有些语句可以延长作用域链，语句执行结束被移除：
            - try-catch 语句的 catch 块：会创建一个新的变量对象，其中包含的是被抛出的错误对象的声明
            - with 语句：会将指定的对象添加在作用域链中
        - **因为 js 中没有块级作用域，所以在 catch 语句块和 with 语句块中定义的变量或函数和外部定义是没有差别的**（特殊！！！）
    - 没有块级作用域
        - 声明变量
            - 使用 var 声明的变量会自动添加到最接近的环境中：
                - 在函数内部 -> 函数的局部环境
                - 在 with 语句中 -> with 语句所在环境
            - 如果初始化变量时没有使用 var 声明，该变量会自动添加到全局环境中（不推荐）
        - 查询标识符：向上逐级查询

- 自动垃圾收集
    - 实现策略
        - 标记清除（常用，推荐）
        - 引用计数（少用，问题多）：存在循环引用风险，导致无法回收
    - 性能问题：垃圾收集的时间间隔
    - 管理内存：为执行中的代码只保存必要的数据。一旦数据不再有用，最好通过将其值设为 null 来释放其引用——**解除引用**，以脱离执行环境（离开作用域的值将被自动标记为可以回收），这样垃圾收集器下次运行时将其回收。适用于全局变量、全局对象的属性以及循环引用变量的引用。（局部变量会在环境销毁时随之销毁）

```javascript
function createPerson(name){
    var localPerson = new Object();
    localPerson.name = name;
    return localPerson;
}
var globalPerson = createPerson("Nicholas");
// 手工接触 globalPerson 的引用
globalPerson = null;
```